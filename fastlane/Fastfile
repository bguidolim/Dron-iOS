default_platform(:ios)

platform :ios do
  before_all do
    xcversion(version: '9.3')
    ensure_git_status_clean
  end

  after_all do
    clean_build_artifacts
    reset_git_repo(force: true)
  end

  desc 'Build and deploy to Crashlytics Beta'
  lane :alpha do
    carthage(
      platform: 'iOS',
      cache_builds: true
    )
    match
    automatic_code_signing(
      use_automatic_signing: false,
      profile_name: ENV['sigh_com.guidolim.Dron_appstore_profile-name'],
      team_id: 'JW682CU4GW',
      code_sign_identity: 'iPhone Distribution'
    )
    increment_build_number(
      build_number: ENV['BITRISE_BUILD_NUMBER']
    )
    add_badge(
      alpha: true,
      shield: "Build-#{get_build_number}-orange",
      glob: '/Dron/**/*.appiconset/*.{png,PNG}'
    )
    gym
    crashlytics(
      groups: 'ios-beta'
    )
  end
end
